<Window x:Class="Markdig.Wpf.SampleApp.StreamingTestWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:markdig="clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"
        Title="LaTeX Math Streaming Test" Height="700" Width="1000"
        Background="#F5F5F5">
    <Window.Resources>
        <Style TargetType="Button">
  <Setter Property="Padding" Value="15,8"/>
        <Setter Property="Margin" Value="5"/>
       <Setter Property="Background" Value="#2196F3"/>
   <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
   <Setter Property="Cursor" Value="Hand"/>
      <Style.Triggers>
 <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#1976D2"/>
        </Trigger>
       <Trigger Property="IsEnabled" Value="False">
     <Setter Property="Background" Value="#CCCCCC"/>
          <Setter Property="Cursor" Value="Arrow"/>
         </Trigger>
          </Style.Triggers>
     </Style>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
        
  <!-- Title -->
   <TextBlock Grid.Row="0" 
             Text="LaTeX Math Streaming Test" 
     FontSize="24" 
          FontWeight="Bold" 
        Margin="0,0,0,15"
   Foreground="#333333"/>
        
        <!-- Description -->
        <TextBlock Grid.Row="1" 
       TextWrapping="Wrap" 
         Margin="0,0,0,10"
       Foreground="#666666">
            <Run Text="This test simulates streaming of Markdown content with LaTeX math expressions."/>
      <LineBreak/>
  <Run Text="Test content includes Chinese text and multiple LaTeX formulas using \(...\) and \[...\] syntax."/>
      <LineBreak/>
            <Run Text="After the fix, the application should not freeze and handle incomplete LaTeX gracefully."/>
    </TextBlock>
        
        <!-- Control Panel -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
            <Button x:Name="StartStreamingButton" 
      Content="Start Streaming" 
          Click="StartStreaming_Click"
   Background="#4CAF50"/>
   <Button x:Name="StopStreamingButton" 
          Content="Stop" 
        Click="StopStreaming_Click"
      IsEnabled="False"
 Background="#F44336"/>
       <Button Content="Clear" Click="Clear_Click"/>
         <Button Content="Fast" Click="FastStreaming_Click"/>
            <Button Content="Slow" Click="SlowStreaming_Click"/>
      
            <TextBlock VerticalAlignment="Center" Margin="15,0,5,0" Text="Speed:"/>
         <Slider x:Name="SpeedSlider" 
         Width="150" 
Minimum="10" 
         Maximum="500" 
    Value="50" 
          TickFrequency="50" 
        IsSnapToTickEnabled="True"
     VerticalAlignment="Center"/>
            <TextBlock x:Name="SpeedLabel" 
     VerticalAlignment="Center" 
            Margin="5,0,0,0" 
       Text="50 ms"
    MinWidth="60"/>
          
      <TextBlock x:Name="StatusLabel" 
     VerticalAlignment="Center" 
  Margin="20,0,0,0" 
        FontWeight="Bold"
     Foreground="#4CAF50"/>
        </StackPanel>
        
        <!-- Content Viewer -->
        <Border Grid.Row="3" 
          BorderBrush="#CCCCCC" 
     BorderThickness="1" 
  Background="White"
             CornerRadius="5">
            <ScrollViewer x:Name="ScrollViewer" 
        VerticalScrollBarVisibility="Auto"
   Padding="15">
        <markdig:MarkdownViewer x:Name="MarkdownViewer" 
            Pipeline="{Binding Pipeline}"/>
</ScrollViewer>
        </Border>
        
   <!-- Progress and Stats -->
      <Grid Grid.Row="4" Margin="0,10,0,0">
      <Grid.ColumnDefinitions>
           <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
    <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="Progress: " VerticalAlignment="Center" Margin="0,0,5,0"/>
                <ProgressBar x:Name="ProgressBar" 
        Width="300" 
 Height="20" 
  Minimum="0" 
    Maximum="100"/>
 <TextBlock x:Name="ProgressLabel" 
          Text="0%" 
             VerticalAlignment="Center" 
   Margin="10,0,0,0"
              MinWidth="50"/>
        </StackPanel>
        
 <StackPanel Grid.Column="1" Orientation="Horizontal">
 <TextBlock Text="Characters: " VerticalAlignment="Center"/>
        <TextBlock x:Name="CharCountLabel" 
          Text="0" 
                     VerticalAlignment="Center" 
    FontWeight="Bold"
    MinWidth="60"/>
     <TextBlock Text="Time: " VerticalAlignment="Center" Margin="15,0,0,0"/>
                <TextBlock x:Name="TimeElapsedLabel" 
 Text="0 sec" 
               VerticalAlignment="Center" 
      FontWeight="Bold"
        MinWidth="60"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
